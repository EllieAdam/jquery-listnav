(function($){$.fn.listnav=function(options){var opts=$.extend({},$.fn.listnav.defaults,options),letters=["_","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","-"],firstClick=!1
return opts.prefixes=$.map(opts.prefixes,function(n){return n.toLowerCase()}),this.each(function(){function init(){if($wrapper.append(createLettersHtml()),$letters=$(".ln-letters",$wrapper).slice(0,1),opts.showCounts&&($letterCount=$(".ln-letter-count",$wrapper).slice(0,1)),addClasses(),addNoMatchLI(),bindHandlers(),opts.flagDisabled&&addDisabledClass(),opts.includeAll||$(".all",$letters).remove(),opts.includeNums||$("._",$letters).remove(),opts.includeOther||$(".-",$letters).remove(),opts.removeDisabled&&$(".ln-disabled",$letters).remove(),$(":last",$letters).addClass("ln-last"),$.cookie&&null!==opts.cookieName){var cookieLetter=$.cookie(opts.cookieName)
null!==cookieLetter&&(opts.initLetter=cookieLetter)}if(""!==opts.initLetter)firstClick=!0,$("."+opts.initLetter.toLowerCase(),$letters).slice(0,1).click()
else if(opts.includeAll)$(".all",$letters).addClass("ln-selected")
else for(var i=opts.includeNums?0:1;letters.length>i;i++)if(counts[letters[i]]>0){firstClick=!0,$("."+letters[i],$letters).slice(0,1).click()
break}}function setLetterCountTop(){var letterCountHeight=$letterCount.outerHeight()
$letterCount.css({top:$("a:first",$wrapper).slice(0,1).position().top-letterCountHeight})}function addClasses(){var str,spl,$this,firstChar="",hasPrefixes=opts.prefixes.length>0,hasFilterSelector=opts.filterSelector.length>0
$($list).children().each(function(){$this=$(this),str=hasFilterSelector?$.trim($this.find(opts.filterSelector).text()).toLowerCase():$.trim($this.text()).toLowerCase(),""!==str&&(hasPrefixes&&(spl=str.split(" "),spl.length>1&&$.inArray(spl[0],opts.prefixes)>-1&&(firstChar=spl[1].charAt(0),addLetterClass(firstChar,$this,!0))),firstChar=str.charAt(0),addLetterClass(firstChar,$this))})}function addLetterClass(firstChar,$el,isPrefix){/\W/.test(firstChar)&&(firstChar="-"),isNaN(firstChar)||(firstChar="_"),$el.addClass("ln-"+firstChar),void 0===counts[firstChar]&&(counts[firstChar]=0),counts[firstChar]++,isPrefix||allCount++}function addDisabledClass(){for(var i=0;letters.length>i;i++)void 0===counts[letters[i]]&&$("."+letters[i],$letters).addClass("ln-disabled")}function addNoMatchLI(){$list.append('<li class="ln-no-match listNavHide">'+opts.noMatchText+"</li>")}function getLetterCount(el){if($(el).hasClass("all"))return allCount
var count=counts[$(el).attr("class").split(" ")[0]]
return void 0!==count?count:0}function bindHandlers(){opts.showCounts&&($wrapper.mouseover(function(){setLetterCountTop()}),$(".ln-letters a",$wrapper).mouseover(function(){var left=$(this).position().left,width=$(this).outerWidth()+"px",count=getLetterCount(this)
$letterCount.css({left:left,width:width}).text(count).addClass("listNavShow").removeClass("listNavHide")}).mouseout(function(){$letterCount.addClass("listNavHide").removeClass("listNavShow")})),$("a",$letters).click(function(e){e.preventDefault()
var $this=$(this),letter=$this.attr("class").split(" ")[0],noMatches=$list.children(".ln-no-match")
if(prevLetter!==letter){if($("a.ln-selected",$letters).removeClass("ln-selected"),"all"===letter)$list.children().addClass("listNavShow").removeClass("listNavHide"),noMatches.addClass("listNavHide").removeClass("listNavShow"),isAll=!0
else{isAll?($list.children().addClass("listNavHide").removeClass("listNavShow"),isAll=!1):""!==prevLetter&&$list.children(".ln-"+prevLetter).addClass("listNavHide").removeClass("listNavShow")
var count=getLetterCount(this)
count>0?($list.children(".ln-"+letter).addClass("listNavShow").removeClass("listNavHide"),noMatches.addClass("listNavHide").removeClass("listNavShow")):noMatches.addClass("listNavShow").removeClass("listNavHide")}prevLetter=letter,$.cookie&&null!==opts.cookieName&&$.cookie(opts.cookieName,letter,{expires:999}),$this.addClass("ln-selected"),$this.blur(),firstClick||null===opts.onClick?firstClick=!1:opts.onClick(letter)}})}function createLettersHtml(){for(var html=[],i=1;letters.length>i;i++)0===html.length&&html.push('<a class="all" href="#">ALL</a><a class="_" href="#">0-9</a>'),html.push('<a class="'+letters[i]+'" href="#">'+("-"===letters[i]?"...":letters[i].toUpperCase())+"</a>")
return'<div class="ln-letters">'+html.join("")+"</div>"+(opts.showCounts?'<div class="ln-letter-count listNavHide">0</div>':"")}var $wrapper,$letters,$letterCount,id=this.id,$list=$(this),counts={},allCount=0,isAll=!0,prevLetter=""
$("#"+id+"-nav").length||$('<div id="'+id+'-nav" class="listNav"/>').insertBefore($list),$wrapper=$("#"+id+"-nav"),init()})},$.fn.listnav.defaults={initLetter:"",includeAll:!0,incudeOther:!1,includeNums:!0,flagDisabled:!0,removeDisabled:!1,noMatchText:"No matching entries",showCounts:!0,cookieName:null,onClick:null,prefixes:[],filterSelector:""}})(jQuery)
